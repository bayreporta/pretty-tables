<html>
<head>
	<link href='http://fonts.googleapis.com/css?family=Roboto+Condensed:400italic,400,300,700' rel='stylesheet' type='text/css'>
	<title>Pretty Tables</title>
	<style type="text/css">
		body {font-size:100%;font-family:'roboto Condensed','san-serif';}
		
		/* SEARCH AND FILTERS
		===================================*/
		#pretty-table-control {border-bottom:1px solid #aaa;padding:20px 0 20px 10px;}
		#pretty-table-search {height:20px;width:30%;border:1px solid #ccc; float:left;}
		#pretty-table-search-options .pretty-table-button:hover {background:#aaa;}
		#execute-search, #reset-search {margin:0 0 0 20px;padding:5px;border-radius: 0;}
		.pretty-table-button {padding: 8px;display: inline;background: #ddd;color: #333;cursor: pointer;margin: 0 10px 0 0;font-size: .8em;border-radius: 5px;}
		.pretty-table-button:nth-of-type(n+3):hover {background:#aaa;}

		/* TABLE STYLE
		===================================*/
		#pretty-table table {width:100%; border-collapse: collapse;}
		#pretty-table td {font-size:.8em;padding:10px;}
		#pretty-table th {font-size:1em;text-align:left;padding:10px;vertical-align: top;}
		#pretty-table tr {border-bottom:1px solid #eee;padding:10px 0;}
		#pretty-table tr:first-of-type {height:50px;border-bottom:1px solid #aaa;cursor:pointer;}

		/* HIDE COLUMNS
		===================================*/
		#pretty-table td:nth-child(n+11), #pretty-table th:nth-child(n+11), #pretty-table th:nth-child(n+5):nth-child(-n+6), #pretty-table td:nth-child(n+5):nth-child(-n+6), #pretty-table td:nth-child(n+2):nth-child(-n+3), #pretty-table th:nth-child(n+2):nth-child(-n+3), #pretty-table td:nth-child(8), #pretty-table th:nth-child(8) {display: none;}


	</style>
</head>
<body>
	<div id="pretty-table">
		<div id="pretty-table-control">
			<div id="pretty-table-search-options">
				<input id="pretty-table-search" type="text" style="width:300px;height:24px;" placeholder="Type to Search">
				<p class="pretty-table-button" id="execute-search">Search</p>
				<p class="pretty-table-button" id="reset-search">Reset</p>
			</div>

			<div id="pretty-table-ask">
				<h4>Type of School</h4>
				<p class="pretty-table-button pretty-table-questions" filter="0">Public</p>
				<p class="pretty-table-button pretty-table-questions" filter="1">Private</p>

				<h4>Opt-Out Rate</h4>
				<p class="pretty-table-button pretty-table-questions" filter="2">10% or Higher</p>
				<p class="pretty-table-button pretty-table-questions" filter="3">25% or Higher</p>
				<p class="pretty-table-button pretty-table-questions" filter="4">50% or Higher</p>

				<h4>Ask a Question</h4>
				<p class="pretty-table-button pretty-table-questions" filter="5">Reported in 2014?</p>
				<p class="pretty-table-button pretty-table-questions" filter="6">Failed to Report in 2014?</p>
				<p class="pretty-table-button pretty-table-questions" filter="7">No Herd Immunity?</p>
				<p class="pretty-table-button pretty-table-questions" filter="8">Decline in Opt-Outs?</p>
				<p class="pretty-table-button pretty-table-questions" filter="9">Increase in Opt-Outs?</p>
			</div>
		</div>
	</div>

	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
	<script src="data/data.json"></script>

	<script>
		/* GLOBAL VARIABLES
		======================================*/	
		var filterStatus = {
			reported: false,
			herd: false,
			increase: false,
			decline: false,
			reportedYes: false,
			opt1: false, //10 opt
			opt2: false, //25 opt
			opt3: false, //50 opt
			public: false,
			private: false,
			showMe: 7465
		}

		/* TABLE FUNCTIONS
		======================================*/
		var prettyTables = {
			data: tableData,
			dataLength: tableData.length,
			columnLength: tableData[0].length,
			init: function(){
				this.createTable();
			},
			createTable: function(){
				var contain, table, td, tr, th;
				var frag = document.createDocumentFragment();
				var frag2 = document.createDocumentFragment();

				contain = document.getElementById('pretty-table');
				table = document.createElement('table');

				/* ROWS
				---------------------------------*/
				for (var i = 0; i < this.dataLength; i++){
					tr = document.createElement('tr');
					if (i == 0){
						for (var j = 0 ; j < this.columnLength; j++){
							th = document.createElement('th');
							th.appendChild(document.createTextNode(this.data[0][j]));
							frag2.appendChild(th);
						}
						tr.appendChild(frag2);
						frag.appendChild(tr);
					}
					else {
						for (var j = 0 ; j < this.columnLength; j++){
							td = document.createElement('td');
							td.appendChild(document.createTextNode(this.data[i][j]));
							frag2.appendChild(td);
						}

						/*reported color
						if (this.data[i][5] === "No" || this.data[i][5] === "Not Known"){
							tr.style.background = "#edc3c3";
						}*/

						/* Establish Attributes for Each Row */
						tr.setAttribute('reported', this.data[i][4]);
						tr.setAttribute('herd-immunity', this.data[i][5]);
						tr.setAttribute('pbe', parseInt(this.data[i][8]));
						tr.setAttribute('type', this.data[i][1]);
						if (parseInt(this.data[i][9]) < 0 || this.data[i][9] === 'Down to None'){
							tr.setAttribute('change', 'decline');
						}
						else if (parseInt(this.data[i][9]) > 0 || this.data[i][9] === 'Up from None'){
							tr.setAttribute('change', 'increase');
						}
						else {
							tr.setAttribute('change', 'neither');
						}

						/* Address # to Show */
						if (i < filterStatus.showMe){
							tr.setAttribute('show-me', 'yes');
						}
						else {
							tr.setAttribute('show-me', 'no');
							tr.setAttribute('style', 'display:none');
						}

						/* Append Row */
						tr.appendChild(frag2);
						frag.appendChild(tr);
					}
				}

				/* TABLE
				---------------------------------*/
				table.appendChild(frag);
				contain.appendChild(table);
			}
		}

		/* INIT FUNCTIONS
		======================================*/	
		prettyTables.init();	

		/* SEARCH FUNCTIONS
		======================================*/	
		var $rows = $("#pretty-table table tr:not(tr:eq(0))");
		var allRows = document.getElementsByTagName('tr');
		function searchTool(){
			var val = $.trim($('#pretty-table-search').val()).replace(/ +/g, ' ').toLowerCase();
		    if (val === ''){
		    	var showMe = document.querySelectorAll('[show-me=yes]');
		    }
		    else if (val !== '') {
		    	 for (var i=1 ; i < allRows.length ; i++){
		    	 	allRows[i].style.display = "table-row";

		    	 	var testText = allRows[i].textContent;
		    		testText = testText.replace(/\s+/g, ' ').toLowerCase();
					if (testText.indexOf(val) == -1){
						allRows[i].style.display = "none";
					}
		    	 }
		    }
		}		
	
		$('#execute-search').on('click', searchTool());
		$('#pretty-table-search').on('keypress', function(e){
			var key = e.which;
			if (key == 13){searchTool();}
		})

		$('#reset-search').on('click', function(){
			$('tr[show-me="yes"]').css('display','table-row');
		    $('tr[show-me="no"]').css('display','none');
		    $('#pretty-table-search').val('');
		})

		/* FILTER FUNCTIONS
		======================================*/	
		function resetQuestions(){
			if (filterStatus.reportedYes == true){$('.pretty-table-button[filter="5"]').click();}
			if (filterStatus.reported == true){$('.pretty-table-button[filter="6"]').click();}
			if (filterStatus.herd == true){$('.pretty-table-button[filter="7"]').click();}
			if (filterStatus.decline == true){$('.pretty-table-button[filter="8"]').click();}
			if (filterStatus.increase == true){$('.pretty-table-button[filter="9"]').click();}
		}

		$('.pretty-table-button').on({
			mouseenter: function(){
				var type = $(this).attr('filter');

				if (type === '0'){
					$(this).css('background','#c5f9f0');
				}
				else if (type === '1'){
					$(this).css('background','#f9f0c5');
				}			
			},
			mouseleave: function(){
				var type = $(this).attr('filter');

				if (type === '0'){
					if (filterStatus.public == true){
						$(this).css('background','#c5f9f0');
					}
					else {
						$(this).css('background','#ddd');
					}
				}
				else if (type === '1'){
					if (filterStatus.private == true){
						$(this).css('background','#f9f0c5');
					}
					else {
						$(this).css('background','#ddd');
					}
				}
			}
		});

		$('.pretty-table-questions').on('click', function(){
			var filterType = $(this).attr('filter');
			switch(filterType){
				case '0':
					var theseRows = document.querySelectorAll('[type=public]');
					if (filterStatus.public == false){
						for (var i = 0 ; i < theseRows.length ; i++){
							theseRows[i].style.background = '#c5f9f0';
						}
						$(this).css('background','#c5f9f0');
						filterStatus.public = true;
					}
					else {
						for (var i = 0 ; i < theseRows.length ; i++){
							theseRows[i].style.background = '#fff';
						}
						$(this).css('background','#ddd');
						filterStatus.public = false;
					}
					break;
				case '1':
					var theseRows = document.querySelectorAll('[type=private]');
					if (filterStatus.private == false){
						for (var i = 0 ; i < theseRows.length ; i++){
							theseRows[i].style.background = '#f9f0c5';
						}
						$(this).css('background','#f9f0c5');
						filterStatus.private = true;
					}
					else {
						for (var i = 0 ; i < theseRows.length ; i++){
							theseRows[i].style.background = '#fff';
						}
						$(this).css('background','#ddd');
						filterStatus.private = false;
					}
					break;				
				case '2':
					var theseRows = document.querySelectorAll('[show-me=yes]');

					//check other opt outs
					if (filterStatus.opt2 == true){
						$('.pretty-table-button[filter="25-opt"]').click();
					}
					else if (filterStatus.opt3 == true){
						$('.pretty-table-button[filter="50-opt"]').click();
					}

					if (filterStatus.opt1 == false){
						for (var i = 0 ; i < theseRows.length ; i++){
							if (parseInt(theseRows[i].attributes.pbe.value) < 10 || theseRows[i].attributes.pbe.value == 'NaN'){
								theseRows[i].style.display = 'none';
							}
						}
						$(this).css('background','#aaa');
						filterStatus.opt1 = true;
					}
					else {
						for (var i = 0 ; i < theseRows.length ; i++){
							theseRows[i].style.display = 'table-row';
						}
						$(this).css('background','#ddd');
						filterStatus.opt1 = false;
					}
					break;
				case '3':
					var theseRows = document.querySelectorAll('[show-me=yes]');

					//check other opt outs
					if (filterStatus.opt1 == true){
						$('.pretty-table-button[filter="10-opt"]').click();
					}
					else if (filterStatus.opt3 == true){
						$('.pretty-table-button[filter="50-opt"]').click();
					}

					if (filterStatus.opt2 == false){
						for (var i = 0 ; i < theseRows.length ; i++){
							if (parseInt(theseRows[i].attributes.pbe.value) < 25 || theseRows[i].attributes.pbe.value == 'NaN'){
								theseRows[i].style.display = 'none';
							}
						}
						$(this).css('background','#aaa');
						filterStatus.opt2 = true;
					}
					else {
						for (var i = 0 ; i < theseRows.length ; i++){
							theseRows[i].style.display = 'table-row';
						}
						$(this).css('background','#ddd');
						filterStatus.opt2 = false;
					}
					break;
				case '4':
					var theseRows = document.querySelectorAll('[show-me=yes]');

					//check other opt outs
					if (filterStatus.opt1 == true){
						$('.pretty-table-button[filter="10-opt"]').click();
					}
					else if (filterStatus.opt2 == true){
						$('.pretty-table-button[filter="25-opt"]').click();
					}

					if (filterStatus.opt3 == false){
						for (var i = 0 ; i < theseRows.length ; i++){
							if (parseInt(theseRows[i].attributes.pbe.value) < 50 || theseRows[i].attributes.pbe.value == 'NaN'){
								theseRows[i].style.display = 'none';
							}
						}
						$(this).css('background','#aaa');
						filterStatus.opt3 = true;
					}
					else {
						for (var i = 0 ; i < theseRows.length ; i++){
							theseRows[i].style.display = 'table-row';
						}
						$(this).css('background','#ddd');
						filterStatus.opt3 = false;
					}
					break;
				case '5':
					var theseRows = document.querySelectorAll('[reported=N]');
					if (filterStatus.reportedYes == false){
						resetQuestions();
						for (var i = 0 ; i < theseRows.length ; i++){
							theseRows[i].style.display = 'none';
						}
						$(this).css('background','#aaa');
						filterStatus.reportedYes = true;
					}
					else {
						for (var i = 0 ; i < theseRows.length ; i++){
							theseRows[i].style.display = 'table-row';
						}
						$(this).css('background','#ddd');
						filterStatus.reportedYes = false;
					}
					break;
				case '6':
					var theseRows = document.querySelectorAll('[reported=Y]');
					if (filterStatus.reported == false){
						resetQuestions();
						for (var i = 0 ; i < theseRows.length ; i++){
							theseRows[i].style.display = 'none';
						}
						$(this).css('background','#aaa');
						filterStatus.reported = true;
					}
					else {
						for (var i = 0 ; i < theseRows.length ; i++){
							theseRows[i].style.display = 'table-row';
						}
						$(this).css('background','#ddd');
						filterStatus.reported = false;
					}
					break;
				case '7':
					var theseRows = document.querySelectorAll('[herd-immunity=Yes]');
					if (filterStatus.herd == false){
						resetQuestions();
						for (var i = 0 ; i < theseRows.length ; i++){
							theseRows[i].style.display = 'none';
						}
						$(this).css('background','#aaa');
						filterStatus.herd = true;
					}
					else {
						for (var i = 0 ; i < theseRows.length ; i++){
							theseRows[i].style.display = 'table-row';
						}
						$(this).css('background','#ddd');
						filterStatus.herd = false;
					}
					break;				
				case '8':
					var theseRows = document.querySelectorAll('[change=neither]');
					var theseRows2 = document.querySelectorAll('[change=increase]');
					if (filterStatus.decline == false){
						resetQuestions();
						for (var i = 0 ; i < theseRows.length ; i++){
							theseRows[i].style.display = 'none';
						}
						for (var i = 0 ; i < theseRows2.length ; i++){
							theseRows2[i].style.display = 'none';
						}
						$(this).css('background','#aaa');
						filterStatus.decline = true;
					}
					else {
						for (var i = 0 ; i < theseRows.length ; i++){
							theseRows[i].style.display = 'table-row';
						}
						for (var i = 0 ; i < theseRows2.length ; i++){
							theseRows2[i].style.display = 'table-row';
						}
						$(this).css('background','#ddd');
						filterStatus.decline = false;
					}
					break;
				case '9':
					var theseRows = document.querySelectorAll('[change=neither]');
					var theseRows2 = document.querySelectorAll('[change=decline]');
					if (filterStatus.increase == false){		
						resetQuestions();			
						for (var i = 0 ; i < theseRows.length ; i++){
							theseRows[i].style.display = 'none';
						}
						for (var i = 0 ; i < theseRows2.length ; i++){
							theseRows2[i].style.display = 'none';
						}
						$(this).css('background','#aaa');
						filterStatus.increase = true;
					}
					else {
						for (var i = 0 ; i < theseRows.length ; i++){
							theseRows[i].style.display = 'table-row';
						}
						for (var i = 0 ; i < theseRows2.length ; i++){
							theseRows2[i].style.display = 'table-row';
						}
						$(this).css('background','#ddd');
						filterStatus.increase = false;
					}
					break;
			}
		})
	

	</script>
</body>

</html>